pack_rows(gr[4, 'family_labels'], gr[4, 'first'], gr[4, 'last'],
hline_after = T)
rm(list = ls())
m <- read_xlsx('01_Data/01_SOEP/measures.xlsx') %>%
arrange(order,within_order) %>%
filter(use_in_paper == 1)
## Groupings
gr <- m %>% ungroup() %>%
mutate(rowid = 1:n()) %>%
group_by(paper_category) %>%
summarise(first = first(rowid),
last = last(rowid)) %>%
data.frame(stringsAsFactors = F)
## Table
m %>%
dplyr::select(one_of('proper_label', 'survey_question', 'outcome-range')) %>%
rename('Variable' = 1,
'Survey Question (translated from German)' = 2,
'Coding' = 3) %>%
kableExtra::kable(., format = 'latex',
booktabs = T,
caption = 'Outcome Variables: survey items') %>%
kable_styling(latex_options = c("hold_position", 'scale_down'),
position = "center") %>%
column_spec(1, width = "4cm") %>%
column_spec(2, width = "7cm") %>%
column_spec(3, width = "7cm") %>%
pack_rows(gr[1, 'family_labels'], gr[1, 'first'], gr[1, 'last'],
hline_after = T) %>%
pack_rows(gr[2, 'family_labels'], gr[2, 'first'], gr[2, 'last'],
hline_after = T) %>%
pack_rows(gr[3, 'family_labels'], gr[3, 'first'], gr[3, 'last'],
hline_after = T) %>%
pack_rows(gr[4, 'family_labels'], gr[4, 'first'], gr[4, 'last'],
hline_after = T) %>%
cat(., file = "03_Results/02_Tables/outcome_items.tex")
## OL
source('02_Code/01_Move_Plots_To_Overleaf.R')
rm(list = ls())
m <- read_xlsx('01_Data/01_SOEP/measures.xlsx') %>%
arrange(order,within_order) %>%
filter(use_in_paper == 1)
## Groupings
gr <- m %>% ungroup() %>%
mutate(rowid = 1:n()) %>%
group_by(paper_category) %>%
summarise(first = first(rowid),
last = last(rowid)) %>%
data.frame(stringsAsFactors = F)
## Table
m %>%
dplyr::select(one_of('proper_label', 'survey_question', 'outcome-range')) %>%
rename('Variable' = 1,
'Survey Question (translated from German)' = 2,
'Coding' = 3) %>%
kableExtra::kable(., format = 'latex',
booktabs = T,
caption = 'Survey items corresponding to outcomes') %>%
kable_styling(latex_options = c("hold_position", 'scale_down'),
position = "center") %>%
column_spec(1, width = "4cm") %>%
column_spec(2, width = "7cm") %>%
column_spec(3, width = "7cm") %>%
pack_rows(gr[1, 'family_labels'], gr[1, 'first'], gr[1, 'last'],
hline_after = T) %>%
pack_rows(gr[2, 'family_labels'], gr[2, 'first'], gr[2, 'last'],
hline_after = T) %>%
pack_rows(gr[3, 'family_labels'], gr[3, 'first'], gr[3, 'last'],
hline_after = T) %>%
pack_rows(gr[4, 'family_labels'], gr[4, 'first'], gr[4, 'last'],
hline_after = T) %>%
cat(., file = "03_Results/02_Tables/outcome_items.tex")
rm(list = ls())
m <- read_xlsx('01_Data/01_SOEP/measures.xlsx') %>%
arrange(order,within_order) %>%
filter(use_in_paper == 1)
## Groupings
gr <- m %>% ungroup() %>%
mutate(rowid = 1:n()) %>%
group_by(paper_category) %>%
summarise(first = first(rowid),
last = last(rowid)) %>%
data.frame(stringsAsFactors = F)
## Table
m %>%
dplyr::select(one_of('proper_label', 'survey_question', 'outcome-range')) %>%
rename('Variable' = 1,
'Survey Question (translated from German)' = 2,
'Coding' = 3) %>%
kableExtra::kable(., format = 'latex',
booktabs = T,
caption = 'Survey items corresponding to outcomes') %>%
kable_styling(latex_options = c("hold_position", 'scale_down'),
position = "center") %>%
column_spec(1, width = "4cm") %>%
column_spec(2, width = "7cm") %>%
column_spec(3, width = "7cm") %>%
pack_rows(gr[1, 'paper_category'], gr[1, 'first'], gr[1, 'last'],
hline_after = F) %>%
pack_rows(gr[2, 'paper_category'], gr[2, 'first'], gr[2, 'last'],
hline_after = F) %>%
pack_rows(gr[3, 'paper_category'], gr[3, 'first'], gr[3, 'last'],
hline_after = F) %>%
pack_rows(gr[4, 'paper_category'], gr[4, 'first'], gr[4, 'last'],
hline_after = F) %>%
cat(., file = "03_Results/02_Tables/outcome_items.tex")
m %>%
dplyr::select(one_of('proper_label', 'survey_question', 'outcome-range')) %>%
rename('Variable' = 1,
'Survey Question (translated from German)' = 2,
'Coding' = 3) %>%
kableExtra::kable(., format = 'latex',
booktabs = T,
caption = 'Survey items corresponding to outcomes') %>%
kable_styling(latex_options = c("hold_position", 'scale_down'),
position = "center") %>%
column_spec(1, width = "4cm") %>%
column_spec(2, width = "7cm") %>%
column_spec(3, width = "7cm") %>%
pack_rows(gr[1, 'paper_category'], gr[1, 'first'], gr[1, 'last'],
hline_after = F) %>%
pack_rows(gr[2, 'paper_category'], gr[2, 'first'], gr[2, 'last'],
hline_after = F) %>%
pack_rows(gr[3, 'paper_category'], gr[3, 'first'], gr[3, 'last'],
hline_after = F) %>%
pack_rows(gr[4, 'paper_category'], gr[4, 'first'], gr[4, 'last'],
hline_after = F) %>%
cat(., file = "03_Results/02_Tables/outcome_items.tex")
## OL
source('02_Code/01_Move_Plots_To_Overleaf.R')
rm(list = ls())
m <- read_xlsx('01_Data/01_SOEP/measures.xlsx') %>%
arrange(order,within_order) %>%
filter(use_in_paper == 1)
## Groupings
gr <- m %>% ungroup() %>%
mutate(rowid = 1:n()) %>%
group_by(paper_category) %>%
summarise(first = first(rowid),
last = last(rowid)) %>%
data.frame(stringsAsFactors = F)
## Table
m %>%
dplyr::select(one_of('proper_label', 'survey_question', 'outcome-range')) %>%
rename('Variable' = 1,
'Survey Question (translated from German)' = 2,
'Coding' = 3) %>%
kableExtra::kable(., format = 'latex',
booktabs = T,
caption = 'Survey items corresponding to outcomes') %>%
kable_styling(latex_options = c("hold_position", 'scale_down'),
position = "center") %>%
column_spec(1, width = "7cm") %>%
column_spec(2, width = "9cm") %>%
column_spec(3, width = "9cm") %>%
pack_rows(gr[1, 'paper_category'], gr[1, 'first'], gr[1, 'last'],
hline_after = F) %>%
pack_rows(gr[2, 'paper_category'], gr[2, 'first'], gr[2, 'last'],
hline_after = F) %>%
pack_rows(gr[3, 'paper_category'], gr[3, 'first'], gr[3, 'last'],
hline_after = F) %>%
pack_rows(gr[4, 'paper_category'], gr[4, 'first'], gr[4, 'last'],
hline_after = F) %>%
cat(., file = "03_Results/02_Tables/outcome_items.tex")
## OL
source('02_Code/01_Move_Plots_To_Overleaf.R')
rm(list = ls())
## Block FE results
res <- read_rds('03_Results/match_exact_results_blockfe.rds') %>%
mutate(sm = case_when(match_on_state == 'yes' ~ 'Match on state',
match_on_state == 'no' ~ 'Not match on state')) %>%
filter(match_on_state == 'no') %>%
mutate(covs = ifelse(covs == 'block_fe', 'OLS + Block FE', 'OLS')) %>%
filter(hc == 'HC0')
## Add labels
res <- read_excel('01_Data/01_SOEP/measures.xlsx') %>%
dplyr::select(var_lab, use_in_paper, paper_category, order, within_order) %>%
left_join(res, ., by = c('outcome' = 'var_lab')) %>%
filter(use_in_paper == 1) %>%
mutate(syear = as.character(syear))
## Get factor levels
faclevs <- res %>%
dplyr::select(proper_label, order, within_order) %>%
distinct(proper_label, order, within_order) %>%
arrange(order, within_order) %>% pull(proper_label)
## Line break
res$proper_label <- sapply(res$proper_label,
haschaR::add_linebreak, min_length = 20)
res$paper_category <- sapply(res$paper_category,
haschaR::add_linebreak, min_length = 15)
res <- res %>%
mutate(proper_label = factor(proper_label, levels = faclevs))
p1 <- ggplot(df, aes(bw, estimate)) +
geom_hline(yintercept = 0, linetype = 'dotted') +
geom_errorbar(aes(ymin = conf.low90, ymax = conf.high90),
position = pd, width = 0, size  = 0.8) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high),
position = pd, width = 0, size = 0.4) +
geom_point(position = pd, shape = 21, fill = 'white',
size = 3) +
facet_grid(proper_label~syear,
scales = 'free_y') +
theme_hanno() +
xlab('Bandwidth (months)') +
ylab('Effect of movement restrictions') +
theme(legend.position = 'bottom') +
theme(strip.text.y = element_text(size = 8)) +
scale_x_continuous(breaks = 1:6) +
theme(panel.spacing = unit(1, "lines"))
pf <- function(df) {
pd <- position_dodge(0.55)
p1 <- ggplot(df, aes(bw, estimate)) +
geom_hline(yintercept = 0, linetype = 'dotted') +
geom_errorbar(aes(ymin = conf.low90, ymax = conf.high90),
position = pd, width = 0, size  = 0.8) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high),
position = pd, width = 0, size = 0.4) +
geom_point(position = pd, shape = 21, fill = 'white',
size = 3) +
facet_grid(proper_label~syear,
scales = 'free_y') +
theme_hanno() +
xlab('Bandwidth (months)') +
ylab('Effect of movement restrictions') +
theme(legend.position = 'bottom') +
theme(strip.text.y = element_text(size = 8)) +
scale_x_continuous(breaks = 1:6) +
theme(panel.spacing = unit(1, "lines"))
p1
}
p1 <- res %>%
filter(covs == 'OLS + Block FE') %>%
filter(str_detect(paper_category, '1|2')) %>%
pf()
p1
rm(list = ls())
## Block FE results
res <- read_rds('03_Results/match_exact_results_blockfe.rds') %>%
mutate(sm = case_when(match_on_state == 'yes' ~ 'Match on state',
match_on_state == 'no' ~ 'Not match on state')) %>%
filter(match_on_state == 'no') %>%
mutate(covs = ifelse(covs == 'block_fe', 'OLS + Block FE', 'OLS')) %>%
filter(hc == 'HC0')
res <- read_excel('01_Data/01_SOEP/measures.xlsx') %>%
dplyr::select(var_lab, use_in_paper, paper_category, order, within_order) %>%
left_join(res, ., by = c('outcome' = 'var_lab')) %>%
filter(use_in_paper == 1) %>%
mutate(syear = as.character(syear))
faclevs <- res %>%
dplyr::select(proper_label, order, within_order) %>%
distinct(proper_label, order, within_order) %>%
arrange(order, within_order) %>% pull(proper_label)
res$proper_label <- sapply(res$proper_label,
haschaR::add_linebreak, min_length = 20)
res$paper_category <- sapply(res$paper_category,
haschaR::add_linebreak, min_length = 15)
res <- res %>%
mutate(proper_label = factor(proper_label, levels = faclevs))
pf <- function(df) {
pd <- position_dodge(0.55)
p1 <- ggplot(df, aes(bw, estimate)) +
geom_hline(yintercept = 0, linetype = 'dotted') +
geom_errorbar(aes(ymin = conf.low90, ymax = conf.high90),
position = pd, width = 0, size  = 0.8) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high),
position = pd, width = 0, size = 0.4) +
geom_point(position = pd, shape = 21, fill = 'white',
size = 3) +
facet_grid(proper_label~syear,
scales = 'free_y') +
theme_hanno() +
xlab('Bandwidth (months)') +
ylab('Effect of movement restrictions') +
theme(legend.position = 'bottom') +
theme(strip.text.y = element_text(size = 8)) +
scale_x_continuous(breaks = 1:6) +
theme(panel.spacing = unit(1, "lines"))
p1
}
p1 <- res %>%
filter(covs == 'OLS + Block FE') %>%
filter(str_detect(paper_category, '1|2')) %>%
pf()
p1
rm(list = ls())
## Block FE results
res <- read_rds('03_Results/match_exact_results_blockfe.rds') %>%
mutate(sm = case_when(match_on_state == 'yes' ~ 'Match on state',
match_on_state == 'no' ~ 'Not match on state')) %>%
filter(match_on_state == 'no') %>%
mutate(covs = ifelse(covs == 'block_fe', 'OLS + Block FE', 'OLS')) %>%
filter(hc == 'HC0')
View(res)
rm(list = ls())
## Block FE results
res <- read_rds('03_Results/match_exact_results_blockfe.rds') %>%
mutate(sm = case_when(match_on_state == 'yes' ~ 'Match on state',
match_on_state == 'no' ~ 'Not match on state')) %>%
filter(match_on_state == 'no') %>%
mutate(covs = ifelse(covs == 'block_fe', 'OLS + Block FE', 'OLS')) %>%
filter(hc == 'HC0')
res <- read_excel('01_Data/01_SOEP/measures.xlsx') %>%
dplyr::select(var_lab, use_in_paper, paper_category, order, within_order) %>%
left_join(res, ., by = c('outcome' = 'var_lab')) %>%
filter(use_in_paper == 1) %>%
mutate(syear = as.character(syear))
faclevs <- res %>%
dplyr::select(proper_label, order, within_order) %>%
distinct(proper_label, order, within_order) %>%
arrange(order, within_order) %>% pull(proper_label)
res$proper_label <- sapply(res$proper_label,
haschaR::add_linebreak, min_length = 20)
res$paper_category <- sapply(res$paper_category,
haschaR::add_linebreak, min_length = 15)
res <- res %>%
mutate(proper_label = factor(proper_label, levels = faclevs))
rm(list = ls())
## Block FE results
res <- read_rds('03_Results/match_exact_results_blockfe.rds') %>%
mutate(sm = case_when(match_on_state == 'yes' ~ 'Match on state',
match_on_state == 'no' ~ 'Not match on state')) %>%
filter(match_on_state == 'no') %>%
mutate(covs = ifelse(covs == 'block_fe', 'OLS + Block FE', 'OLS')) %>%
filter(hc == 'HC0')
## Add labels
res <- read_excel('01_Data/01_SOEP/measures.xlsx') %>%
dplyr::select(var_lab, use_in_paper, paper_category, order, within_order) %>%
left_join(res, ., by = c('outcome' = 'var_lab')) %>%
filter(use_in_paper == 1) %>%
mutate(syear = as.character(syear))
## Get factor levels
faclevs <- res %>%
dplyr::select(proper_label, order, within_order) %>%
distinct(proper_label, order, within_order) %>%
arrange(order, within_order) %>% pull(proper_label)
levels(res$proper_label) <- sapply(levels(res$proper_label),
haschaR::add_linebreak, min_length = 20)
res$paper_category <- sapply(res$paper_category,
haschaR::add_linebreak, min_length = 15)
res <- res %>%
mutate(proper_label = factor(proper_label, levels = faclevs))
pf <- function(df) {
pd <- position_dodge(0.55)
p1 <- ggplot(df, aes(bw, estimate)) +
geom_hline(yintercept = 0, linetype = 'dotted') +
geom_errorbar(aes(ymin = conf.low90, ymax = conf.high90),
position = pd, width = 0, size  = 0.8) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high),
position = pd, width = 0, size = 0.4) +
geom_point(position = pd, shape = 21, fill = 'white',
size = 3) +
facet_grid(proper_label~syear,
scales = 'free_y') +
theme_hanno() +
xlab('Bandwidth (months)') +
ylab('Effect of movement restrictions') +
theme(legend.position = 'bottom') +
theme(strip.text.y = element_text(size = 8)) +
scale_x_continuous(breaks = 1:6) +
theme(panel.spacing = unit(1, "lines"))
p1
}
p1 <- res %>%
filter(covs == 'OLS + Block FE') %>%
filter(str_detect(paper_category, '1|2')) %>%
pf()
p1
ggsave('03_Results/01_Plots/Plot_Paper_Main/BW_Sens_Block1.pdf',
width = 8, height = 9)
p1 <- res %>%
filter(covs == 'OLS + Block FE') %>%
filter(str_detect(paper_category, '3|4')) %>%
pf()
p1
rm(list = ls())
## Block FE results
res <- read_rds('03_Results/match_exact_results_blockfe.rds') %>%
mutate(sm = case_when(match_on_state == 'yes' ~ 'Match on state',
match_on_state == 'no' ~ 'Not match on state')) %>%
filter(match_on_state == 'no') %>%
mutate(covs = ifelse(covs == 'block_fe', 'OLS + Block FE', 'OLS')) %>%
filter(hc == 'HC0')
## Add labels
res <- read_excel('01_Data/01_SOEP/measures.xlsx') %>%
dplyr::select(var_lab, use_in_paper, paper_category, order, within_order) %>%
left_join(res, ., by = c('outcome' = 'var_lab')) %>%
filter(use_in_paper == 1) %>%
mutate(syear = as.character(syear))
## Get factor levels
faclevs <- res %>%
dplyr::select(proper_label, order, within_order) %>%
distinct(proper_label, order, within_order) %>%
arrange(order, within_order) %>% pull(proper_label)
## Line break
levels(res$proper_label) <- sapply(levels(res$proper_label),
haschaR::add_linebreak, min_length = 15)
res$paper_category <- sapply(res$paper_category,
haschaR::add_linebreak, min_length = 15)
## Proper label to factor
res <- res %>%
mutate(proper_label = factor(proper_label, levels = faclevs))
## Econ
pf <- function(df) {
pd <- position_dodge(0.55)
p1 <- ggplot(df, aes(bw, estimate)) +
geom_hline(yintercept = 0, linetype = 'dotted') +
geom_errorbar(aes(ymin = conf.low90, ymax = conf.high90),
position = pd, width = 0, size  = 0.8) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high),
position = pd, width = 0, size = 0.4) +
geom_point(position = pd, shape = 21, fill = 'white',
size = 3) +
facet_grid(proper_label~syear,
scales = 'free_y') +
theme_hanno() +
xlab('Bandwidth (months)') +
ylab('Effect of movement restrictions') +
theme(legend.position = 'bottom') +
theme(strip.text.y = element_text(size = 8)) +
scale_x_continuous(breaks = 1:6) +
theme(panel.spacing = unit(1, "lines"))
p1
}
## ## ## ## ## ## ## ## ## ##
## Make plot, BW = 2
p1 <- res %>%
filter(covs == 'OLS + Block FE') %>%
filter(str_detect(paper_category, '1|2')) %>%
pf()
p1
ggsave('03_Results/01_Plots/Plot_Paper_Main/BW_Sens_Block1.pdf',
width = 8, height = 9)
## ## ## ##
p1 <- res %>%
filter(covs == 'OLS + Block FE') %>%
filter(str_detect(paper_category, '3|4')) %>%
pf()
p1
rm(list = ls())
## Block FE results
res <- read_rds('03_Results/match_exact_results_blockfe.rds') %>%
mutate(sm = case_when(match_on_state == 'yes' ~ 'Match on state',
match_on_state == 'no' ~ 'Not match on state')) %>%
filter(match_on_state == 'no') %>%
mutate(covs = ifelse(covs == 'block_fe', 'OLS + Block FE', 'OLS')) %>%
filter(hc == 'HC0')
## Add labels
res <- read_excel('01_Data/01_SOEP/measures.xlsx') %>%
dplyr::select(var_lab, use_in_paper, paper_category, order, within_order) %>%
left_join(res, ., by = c('outcome' = 'var_lab')) %>%
filter(use_in_paper == 1) %>%
mutate(syear = as.character(syear))
## Get factor levels
faclevs <- res %>%
dplyr::select(proper_label, order, within_order) %>%
distinct(proper_label, order, within_order) %>%
arrange(order, within_order) %>% pull(proper_label)
## Line break
levels(res$proper_label) <- sapply(levels(res$proper_label),
haschaR::add_linebreak, min_length = 10)
res$paper_category <- sapply(res$paper_category,
haschaR::add_linebreak, min_length = 15)
## Proper label to factor
res <- res %>%
mutate(proper_label = factor(proper_label, levels = faclevs))
## Econ
pf <- function(df) {
pd <- position_dodge(0.55)
p1 <- ggplot(df, aes(bw, estimate)) +
geom_hline(yintercept = 0, linetype = 'dotted') +
geom_errorbar(aes(ymin = conf.low90, ymax = conf.high90),
position = pd, width = 0, size  = 0.8) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high),
position = pd, width = 0, size = 0.4) +
geom_point(position = pd, shape = 21, fill = 'white',
size = 3) +
facet_grid(proper_label~syear,
scales = 'free_y') +
theme_hanno() +
xlab('Bandwidth (months)') +
ylab('Effect of movement restrictions') +
theme(legend.position = 'bottom') +
theme(strip.text.y = element_text(size = 8)) +
scale_x_continuous(breaks = 1:6) +
theme(panel.spacing = unit(1, "lines"))
p1
}
## ## ## ## ## ## ## ## ## ##
## Make plot, BW = 2
p1 <- res %>%
filter(covs == 'OLS + Block FE') %>%
filter(str_detect(paper_category, '1|2')) %>%
pf()
p1
ggsave('03_Results/01_Plots/Plot_Paper_Main/BW_Sens_Block1.pdf',
width = 8, height = 9)
## ## ## ##
p1 <- res %>%
filter(covs == 'OLS + Block FE') %>%
filter(str_detect(paper_category, '3|4')) %>%
pf()
p1
library(devtools)
library(roxygen2)
## Declare WDs
wd_h <- '/Users/hanno/Local_Projects/haschaR/'
wd_s <- '/Users/saschariaz/Google\ Drive_Harvard/Git/haschaR'
## Set WD
haschaR::detect_wd(wd_h = wd_h, wd_alt = wd_s, user_name = 'Hanno')
document()
## PUSH BEFORE REINSTALLING
devtools::install_github('https://github.com/hhilbig/haschaR', force = T)
